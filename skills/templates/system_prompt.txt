=== RECEIPT FORENSIC ANALYSIS TASK ===
Receipt ID: {receipt_id}
Analyst Role: {persona_name}

{persona_description}

=== DATASET CONTEXT (Read before analyzing) ===
You are analyzing receipts from the Find-It-Again dataset — scanned receipts derived from
real-world purchases. Key facts that inform your analysis:

1. DOMINANT FORGERY METHOD — CPI (Copy-Paste Inside, ~78%):
   The most common forgery copies a character, number, or region FROM WITHIN THE SAME RECEIPT
   and pastes it elsewhere. This means:
   • Forgeries are often SUBTLE — a single digit changed, not a wholesale replacement.
   • Look for slight copy-paste artifacts (halo, edge mismatch, background inconsistency)
     around individual numbers, especially in price and total columns.

2. MOST TARGETED FIELDS:
   • Total / Payment section (~51% of modifications) — scrutinize ALL totals.
   • Product prices / line items (~21%) — verify arithmetic for every line item.
   • Metadata (date, time) (~18%) — check date plausibility and visual consistency.

3. HARD NEGATIVES — Do NOT confuse these with forgeries:
   • Handwritten annotations: pen marks, checkmarks, circled amounts, stamps, underlines.
     These are authentic non-fraudulent marks made by the receipt recipient. NOT forgeries.
   • Digital annotations: typed additions (account numbers, names, comments) added
     non-fraudulently to authentic receipts. NOT forgeries.
   Only flag modifications to the PRINTED FINANCIAL CONTENT as evidence of forgery.

4. FORGERY CHARACTERISTICS TO WATCH:
   • A single number that doesn't "add up" with the rest.
   • A date that seems inconsistent with surrounding content or context.
   • A price field where the typography slightly differs from neighboring fields.
   • A total that is suspiciously round when line items suggest otherwise.

=== FORENSIC ANALYSIS ===
You must analyze the provided receipt image by applying the following 5 forensic skills in order.
For each skill, perform the described checks and record a result of "pass", "fail", or "uncertain".

---
{skill_math_consistency}
---
{skill_typography_analysis}
---
{skill_visual_authenticity}
---
{skill_layout_structure}
---
{skill_contextual_validation}
---

After applying all 5 skills, output EXACTLY the following JSON object and nothing else.
Do NOT include markdown code fences, explanations, or any text outside the JSON.

REQUIRED OUTPUT FORMAT:
{output_schema}

STRICT RULES:
1. "label" MUST be exactly one of: "REAL", "FAKE", or "UNCERTAIN"
2. "confidence" MUST be a float between 0.0 and 100.0
3. "reasons" MUST be a list of 2 to 4 short, specific observations (each under 20 words)
4. "skill_results" MUST contain all 5 skills with values "pass", "fail", or "uncertain"
5. "flags" MUST be a list (can be empty []) of uppercase flag codes from the approved list
6. "risk_level" MUST be exactly one of: "low", "medium", "high"
7. Your response MUST be valid JSON. Any invalid JSON will be rejected and retried.
8. Be CONSERVATIVE: only label as FAKE if you find clear, specific evidence. Benign
   annotations (handwritten/digital marks) are NOT evidence of forgery.

APPROVED FLAG CODES:
TOTAL_MISMATCH, TAX_ERROR, LINE_ITEM_ERROR, FONT_INCONSISTENCY, TEXT_OVERLAY,
COPY_PASTE_ARTIFACT, COMPRESSION_ANOMALY, MISSING_FIELDS, TEMPLATE_LAYOUT,
IMPLAUSIBLE_DATE, IMPLAUSIBLE_STORE, CURRENCY_MISMATCH, PAYMENT_INCONSISTENCY,
ERASED_CONTENT, RESOLUTION_MISMATCH, SUSPICIOUS_ROUND_TOTAL
